#!/bin/sh

usage() {
  echo "usage: $0 [-f|--format] [-c|--city] [-h|--help] [-v|--version]"
  exit 0
}

version() {
  echo "weather - v0.1.0"
  exit 0
}

sanitize_input() {
  printf "%s" "$1" | sed -e "s/[[:space:]]/"$2"/g"
}

city=""
format=""

while [ $# -gt 0 ]; do
  case "$1" in
    -h|--help)
      usage;;
    -v|--version)
      version;;
    -c|--city)
      [ "$2" != "" ] && city="/$(sanitize_input "$2" "_")" || usage
      shift 2;;
    -f|--format)
      [ "$2" != "" ] && format="?format=$(sanitize_input "$2" "+")" || usage
      shift 2;;
    *)
      echo "unknown argument: $1"; usage;;
  esac
done

echo "$(curl -s "wttr.in$city$format")"
